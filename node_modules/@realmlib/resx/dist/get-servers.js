"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const querystring_1 = require("querystring");
const endpoints_1 = require("./endpoints");
const http_client_1 = require("./http-client");
const SERVER_REGEX = /<Server><Name>(\w+)<\/Name><DNS>(\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})<\/DNS>/g;
/**
 * Downloads the latest server list and returns the
 * result as a dictionary of servers keyed by server name.
 */
async function getServers() {
    const guid = (Math.random() * 100000 + 10000).toFixed(0);
    const query = querystring_1.stringify({ guid });
    const httpResult = await http_client_1.get(endpoints_1.Endpoints.CharList + `?${query}`);
    const result = httpResult.toString();
    const servers = {};
    let match = SERVER_REGEX.exec(result);
    while (match !== null) {
        const name = match[1];
        const address = match[2];
        servers[name] = {
            name, address,
        };
        match = SERVER_REGEX.exec(result);
    }
    return servers;
}
exports.getServers = getServers;
